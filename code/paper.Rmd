---
title: "Community Data Science meets Digital Heritage: Controversies about World Heritage Sites in the Online Community of Wikipedia"
---

Load the data


```{r}
library(tidyverse)

# all WH sites with WP pages (n = 584)
page_data_for_all_pages <- readRDS("data/page_data_for_all_pages.rds")

# all WH sites, with and without WP pages (n = 846)
wh_wiki_table <- read_csv('data/wh_wiki_table.csv')

```


What countries are most represented?


```{r}
library("rnaturalearth")
library("rnaturalearthdata")
world <- ne_countries(scale = "medium", returnclass = "sf")

  # get country of site from location text
  # Laos, Czech Republic, Micronesia, Zimbabwe, South Sudan, Chad, 
  # Central African Republic, Congo, Gabon, Cameroon, Nigeria, Bosnia and Herzegovina
  #  Cote d'Ivoire, Sierra Leone, Guyana, Belize, 
  country_names <-  paste(c(world$name, 
                            "United States",
                            "Czech Republic",
                             "Antigua & Barbuda",
                            "Saint Kitts and Nevis"
                            ),
                          collapse="|")

  page_data_for_all_pages_location <- 
    page_data_for_all_pages %>% 
    mutate(country = str_extract(Location, 
                                 regex(country_names, 
                                       ignore.case=TRUE))) %>% 
    mutate(country = case_when(
      country == "United States" ~ "United States of America",
      country == "Czech Republic" ~ "Czechia",
      country == "Antigua & Barbuda" ~ "Antigua and Barb.",
      country == "Saint Kitts and Nevis" ~ "St. Kitts and Nevis",
      TRUE ~ as.character(country)))
  
  
wh_wiki_table_location <- 
  wh_wiki_table %>% 
  mutate(country = str_extract(Location, 
                                 regex(country_names, 
                                       ignore.case=TRUE))) %>% 
    mutate(country = case_when(
      country == "United States" ~ "United States of America",
      country == "Czech Republic" ~ "Czechia",
      country == "Antigua & Barbuda" ~ "Antigua and Barb.",
      country == "Saint Kitts and Nevis" ~ "St. Kitts and Nevis",
      TRUE ~ as.character(country)))
  
```


```{r}

wh_wk_country_counts <- 
page_data_for_all_pages_location %>% 
  count(country) %>% 
  filter(!is.na(country))

theme_nogrid <- function (base_size = 12, base_family = "") {
  theme_bw(base_size = base_size, 
           base_family = base_family) %+replace% 
    theme(panel.grid = element_blank() )   
}

median_number_wp_pages_per_country <- 
  median(wh_wk_country_counts$n)

estimate_mode <- function(x) {
  d <- density(x)
  d$x[which.max(d$y)]
}

mode_number_wp_pages_per_country <- 
  round(estimate_mode(wh_wk_country_counts$n), 1)

wh_wk_country_counts_hist <- 
ggplot(wh_wk_country_counts,
       aes(n)) +
  geom_histogram() +
  annotate("text", x = 15, y = 30, 
           label = str_glue('Median = {median_number_wp_pages_per_country} WP pages/country\nMode = {mode_number_wp_pages_per_country} WP pages/country'),
           size = 2) +
  theme_nogrid(12)

wh_wk_country_counts_bar <- 
ggplot(wh_wk_country_counts,
       aes(reorder(country, n),
           n)) +
  geom_col() +
  coord_flip() +
  theme_minimal(base_size = 6) +
  xlab("")
```


Here's a map of countries showing which has the most WP pages for WH sites

```{r}
sf_map_data <- 
world %>% 
  filter(name != "Antartica") %>% 
  left_join(wh_wk_country_counts,
            by = c( 'name' = 'country')) %>% 
  select(name, n, geometry) 

wh_wk_country_count_map <- 
ggplot(data = sf_map_data) +
    geom_sf(aes(fill = n)) +
    scale_fill_viridis_c(na.value="grey90") +
  coord_sf() +
  theme_minimal()
```

Combine map and histogram

```{r}
wh_wk_country_count_map +
  annotation_custom(ggplotGrob(wh_wk_country_counts_hist), 
                    xmin = -190, 
                    xmax = -90, 
                    ymin= 10, 
                    ymax=-70) 
```

Map of the ratio of WH sites with WP pages, per country


```{r}
wh_wiki_table_location_prop <- 
wh_wiki_table_location %>% 
  mutate(has_wp_page = ifelse(!is.na(site_page_name), 1, 0)) %>% 
  group_by(country) %>% 
  summarise(prop_sites_with_pages = sum(has_wp_page) / n()) %>% 
  filter(!is.na(country))

wh_wk_country_prop_hist <- 
ggplot(wh_wiki_table_location_prop,
       aes(prop_sites_with_pages)) +
  geom_histogram() +
  theme_nogrid(10)

wh_wk_country_all_counts <- 
wh_wiki_table_location %>% 
  count(country) %>% 
  filter(!is.na(country)) %>% 
  left_join(wh_wiki_table_location_prop)

wh_wk_country_prop_scatter <- 
ggplot(wh_wk_country_all_counts,
       aes(prop_sites_with_pages, n)) +
  geom_point() +
  coord_fixed(0.02) +
  theme_nogrid(6)

wh_wk_country_prop_scatter_marginal <- 
ggExtra::ggMarginal(wh_wk_country_prop_scatter,
                    type = "histogram")

sf_map_data_prop <- 
world %>% 
  filter(name != "Antartica") %>% 
  left_join(wh_wiki_table_location_prop,
            by = c( 'name' = 'country')) %>% 
  select(name, prop_sites_with_pages, geometry) 

wh_wk_country_prop_map <- 
ggplot(data = sf_map_data_prop) +
    geom_sf(aes(fill = prop_sites_with_pages)) +
    scale_fill_viridis_c(na.value="grey90") +
  coord_sf() +
  theme_minimal()

wh_wk_country_prop_map +
  annotation_custom((wh_wk_country_prop_scatter_marginal), 
                    xmin = -190, 
                    xmax = -90, 
                    ymin= 10, 
                    ymax=-70) 
```



  - length of articles http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.451.4208&rep=rep1&type=pdf 
  - edit history to identify: diversity of contributions, 
  - reverts in edits for spotting contentious topics https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0038869 http://www.contropedia.net/  http://wwm.phy.bme.hu/ 
    - vandalism traces in edit history
  - talk page length
  - number of links in each page
  - page views: https://www.sciencedirect.com/science/article/abs/pii/S0006320716301240 
  - timing of edits: political events? Brexit?
    - citations in articles: https://arxiv.org/abs/0705.2106
  - are the citations scholarly? Archaeological? Meskell?
    - citations to these articles: https://www.tandfonline.com/doi/full/10.1080/0194262X.2016.1206052 
  - network analysis of editors, clusters of editors
  - sentiment analysis of talk pages
  - geolocation of anon editors by IP address
  - bots and technicity https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0171774 but see https://dl.acm.org/citation.cfm?id=3134684 
  
  - Compare to 10000 random Wikipedia sites
  - Compare to WH sites in media & academic literature
  